!function(e){var t={};function i(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:s})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=2)}([function(e,t){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(i=window)}e.exports=i},function(e,t){e.exports=XP},function(e,t,i){e.exports=i(3)},function(e,t,i){(function(t){const s="undefined"!=typeof window?window:t,r=s.XP||i(1),n=s.XPEmitter||i(4),o=i(5),a=i(6),l=i(7),u=i(8),c=i(9);e.exports=new r.Class("XPSchema",{extends:n,initialize(e){n.call(this),this.fields=e,this.mapped=r.findDeep(this.fields,e=>e&&r.isString(e.alias,!0))},getField(e){if(r.assertArgument(r.isVoid(e)||r.isString(e,!0),1,"string"),!e)return null;let t=this,i=this.fields,s=e.split(".");return s=s.map(e=>(i=t&&t.fields,e=Object.keys(i||{}).find(t=>e===i[t].alias)||e,t=i&&i[e],e)),r.get(this.fields,s.join("."))||null},filter:{promise:!0,value(e,t,i){r.waterfall([t=>this._assert({item:e},t),i=>r.attempt(i=>i(null,o(this,e,t)),i)],i)}},map:{promise:!0,value(e,t,i){r.waterfall([i=>this._assert({item:e,options:t},i),i=>r.attempt(i=>i(null,this.mapped?a(this,e,t):e),i)],i)}},restrict:{promise:!0,value(e,t,i){r.waterfall([i=>this._assert({item:e,options:t},i),i=>r.attempt(i=>i(null,l(this,e,t)),i)],i)}},sanitize:{promise:!0,value(e,t,i){r.waterfall([i=>this._assert({item:e,options:t},i),i=>r.attempt(i=>i(null,u(this,e,t)),i)],i)}},validate:{promise:!0,value(e,t,i){r.waterfall([i=>this._assert({item:e,options:t},i),i=>r.attempt(i=>i(null,c(this,e,t)),i)],i)}},_assert(e,t){r.iterate(e,(e,t,i)=>e(this["_assert"+r.capitalize(i)](t)),t)},fields:{set(e){return this.fields||e},validate:e=>!r.isObject(e)&&"Object"},mapped:{set(e){return r.isDefined(this.mapped)?this.mapped:Boolean(e)}},sanitizers:{static:!0,writable:!1,value:Object.freeze(Object.keys(u.sanitizers))},types:{static:!0,writable:!1,value:Object.freeze(Object.keys(c.types))},validators:{static:!0,writable:!1,value:Object.freeze(Object.keys(c.validators))},_assertItem:e=>!r.isObject(e)&&r.ValidationError("item","Object"),_assertOptions:e=>!r.isVoid(e)&&!r.isObject(e)&&r.ValidationError("options","Object")}),"undefined"!=typeof window&&(window.XPSchema=e.exports)}).call(t,i(0))},function(e,t){e.exports=XPEmitter},function(e,t,i){(function(t){const s=("undefined"!=typeof window?window:t).XP||i(1);e.exports=function(t,i,r){return Object.keys(i).forEach(n=>{let o=Object.keys(t.fields||{}).find(e=>t.fields[e].alias===n)||n,a=t.fields[o],l=i[n];if(a&&"reserved"!==a.access&&("readonly"!==a.access||r.reading)){if(a.fields||a.recursive)return a.list?void Array.from(s.isArray(l)?l:[]).forEach(i=>s.isObject(i)&&e.exports(a.recursive?t:a,i,r)):s.isObject(l)&&e.exports(a.recursive?t:a,l,r)}else delete i[n]}),i}}).call(t,i(0))},function(e,t,i){(function(t){const s=("undefined"!=typeof window?window:t).XP||i(1);e.exports=function(t,i,r){return Object.keys(i).forEach(n=>{let o=r.reading&&n||Object.keys(t.fields||{}).find(e=>t.fields[e].alias===n)||n,a=t.fields[o]&&t.fields[o].alias||o,l=t.fields[o],u=i[n];if(l&&a!==o&&(i[r.reading?a:o]=u),l&&a!==o&&delete i[r.reading?o:a],l&&(l.fields||l.recursive))return l.list?void Array.from(s.isArray(u)?u:[]).forEach(i=>s.isObject(i)&&e.exports(l.recursive?t:l,i,r)):s.isObject(u)&&e.exports(l.recursive?t:l,u,r)}),i}}).call(t,i(0))},function(e,t,i){(function(t){const s=("undefined"!=typeof window?window:t).XP||i(1);e.exports=function(t,i,r){return Object.keys(i).forEach(r=>{let n=Object.keys(t.fields||{}).find(e=>t.fields[e].alias===r)||r,o=t.fields[n],a=i[r];if(o){if(o.fields||o.recursive)return o.list?void Array.from(s.isArray(a)?a:[]).forEach(i=>s.isObject(i)&&e.exports(o.recursive?t:o,i)):s.isObject(a)&&e.exports(o.recursive?t:o,a)}else delete i[r]}),i}}).call(t,i(0))},function(e,t,i){(function(t){const s=("undefined"!=typeof window?window:t).XP||i(1);function r(t,i,r){let n=s.isVoid(r.index)&&t.list?"list":"type",o=e.exports.sanitizers[n](s.toUseful(i,!0),t[n]),a=e.exports.validators[n](o,t[n],r.path);if(a)throw a;return o}e.exports=function(t,i,n){return Object.keys(t.fields||{}).forEach(o=>{let a=t.fields[o].alias||o,l=t.fields[o],u=n.path?`${n.path}.${a}`:a,c=n.current&&n.current[a];if(i[a]=r(l,n.current||s.isUseful(i[a])||!s.isUseful(l.value)?i[a]:s.isFunction(l.value)?l.value():l.value,{path:u}),!l.list)return s.isObject(i[a])&&(i[a]=e.exports(l.recursive?t:l,i[a],{current:c,path:u}));s.isArray(i[a])&&i[a].forEach((n,o)=>(i[a][o]=n=r(l,n,{path:`${u}.${o}`,index:o}),s.isObject(n)&&(i[a][o]=e.exports(l.recursive?t:l,n,{current:c&&c[o],path:`${u}.${o}`}))))}),i},e.exports.types={boolean:s.isBoolean,date:s.isDate,number:s.isFinite,object:s.isObject,string:s.isString,uuid:s.isUUID},e.exports.sanitizers={list:(e,t)=>t&&s.isVoid(e)?[]:t&&s.isString(e)?e.split(/\s*,\s*/):t&&!s.isArray(e)?[e]:e,type:(e,t)=>(["boolean","date","number","string"].includes(t)&&(e=s.toPrimitive(e,t,!0)),["boolean"].includes(t)?e||!1:s.toDefined(e))},e.exports.validators={list:(e,t,i)=>t&&!s.isArray(e)?s.error(400,`${i?`"${i}"`:"item"} must be a list`):null,type:(t,i,r)=>!e.exports.types[i]||e.exports.types[i](t)||s.isVoid(t)?null:s.error(400,`${r?`"${r}"`:"item"} must be ${i}`)}}).call(t,i(0))},function(e,t,i){(function(t){const s=("undefined"!=typeof window?window:t).XP||i(1);function r(t,i,r){let n=s.isVoid(r.index)&&t.list?"list":"type",o=e.exports.validators[n](i,t[n],r.path);if(o)throw o;return Object.keys(t).forEach(n=>{if(e.exports.validators[n]&&!["list","type"].includes(n)&&("statement"!==n||r.current)&&s.isTruthy(o=e.exports.validators[n](i,t[n],r.path,r.memento)))throw o}),i}e.exports=function(t,i,n){return Object.keys(t.fields||{}).forEach(o=>{let a=t.fields[o].alias||o,l=t.fields[o],u=n.path?`${n.path}.${a}`:a,c=n.current&&n.current[a];if(r(l,i[a],{current:n.current,memento:c,path:u}),!l.list)return s.isObject(i[a])&&e.exports(l.recursive?t:l,i[a],{current:c,path:u});s.isArray(i[a])&&i[a].forEach((i,o)=>(r(l,i,{current:n.current,memento:c&&c[o],path:`${u}.${o}`,index:o}),s.isObject(i)&&e.exports(l.recursive?t:l,i,{current:c&&c[o],path:`${u}.${o}`})))}),i},e.exports.types={boolean:s.isBoolean,date:s.isDate,number:s.isFinite,object:s.isObject,string:s.isString,uuid:s.isUUID},e.exports.validators={list:(e,t,i)=>t&&!s.isArray(e)?s.error(400,`${i?`"${i}"`:"item"} must be a list.`):null,max:(e,t,i)=>!(!s.isFinite(e)||!s.isFinite(t))&&(e>t?s.error(400,`${i?`"${i}"`:"item"} must be up to ${t}.`):null),maxDate:(e,t,i)=>!(!s.isDefined(e=s.toDate(e))||!s.isDefined(t=s.toDate(t)))&&(e>t?s.error(400,`${i?`"${i}"`:"item"} must be up to ${s.toDate(t).toISOString()}.`):null),maxExclusive:(e,t,i)=>!(!s.isFinite(e)||!s.isFinite(t))&&(e>=t?s.error(400,`${i?`"${i}"`:"item"} must be lower than ${t}.`):null),maxExclusiveDate:(e,t,i)=>!(!s.isDefined(e=s.toDate(e))||!s.isDefined(t=s.toDate(t)))&&(e>=t?s.error(400,`${i?`"${i}"`:"item"} must be lower than ${s.toDate(t).toISOString()}.`):null),maxItems:(e,t,i)=>!(!s.isArray(e,!0)||!s.isFinite(t)||t<1)&&(e.length>t?s.error(400,`${i?`"${i}"`:"item"} must be up to ${t} items.`):null),maxLength:(e,t,i)=>!(!s.isString(e)||!s.isFinite(t)||t<1)&&(e.length>t?s.error(400,`${i?`"${i}"`:"item"} must be up to ${t} chars.`):null),min:(e,t,i)=>!(!s.isFinite(e)||!s.isFinite(t))&&(e<t?s.error(400,`${i?`"${i}"`:"item"} must be at least ${t}.`):null),minDate:(e,t,i)=>!(!s.isDefined(e=s.toDate(e))||!s.isDefined(t=s.toDate(t)))&&(e<t?s.error(400,`${i?`"${i}"`:"item"} must be at least ${s.toDate(t).toISOString()}.`):null),minExclusive:(e,t,i)=>!(!s.isFinite(e)||!s.isFinite(t))&&(e<=t?s.error(400,`${i?`"${i}"`:"item"} must be greater than ${t}.`):null),minExclusiveDate:(e,t,i)=>!(!s.isDefined(e=s.toDate(e))||!s.isDefined(t=s.toDate(t)))&&(e<=t?s.error(400,`${i?`"${i}"`:"item"} must be greater than ${s.toDate(t).toISOString()}.`):null),minItems:(e,t,i)=>!(!s.isArray(e,!0)||!s.isFinite(t)||t<1)&&(e.length<t?s.error(400,`${i?`"${i}"`:"item"} must be at least ${t} items.`):null),minLength:(e,t,i)=>!(!s.isString(e)||!s.isFinite(t))&&(e.length<t?s.error(400,`${i?`"${i}"`:"item"} must be at least ${t} chars.`):null),options:(e,t,i)=>!!(s.isUseful(e)&&s.isPrimitive(e)&&s.isArray(t,!0))&&(t.includes(e)?null:s.error(400,`${i?`"${i}"`:"item"} can't be "${e}".`)),pattern:(e,t,i)=>!(!s.isString(e)||!s.isString(t,!0)&&!s.isRegExp(t))&&(s.isVoid(t=s.toRegExp(t))||t.test(e)?null:s.error(400,`${i?`"${i}"`:"item"} can't be "${e}".`)),required:(e,t,i)=>t&&(!s.isUseful(e)||s.isFalse(e)||s.isArray(e,!1))?s.error(400,`${i?`"${i}"`:"item"} must be set.`):null,statement:(e,t,i,r)=>"const"!==t||s.isEquivalent(e,r)?"final"!==t||s.isVoid(r)||s.isEquivalent(e,r)?null:s.error(409,`${i?`"${i}"`:"item"} isn't rewritable.`):s.error(409,`${i?`"${i}"`:"item"} is immutable.`),step:(e,t,i)=>!(!s.isFinite(e)||!s.isFinite(t))&&(e%t!=0?s.error(400,`${i?`"${i}"`:"item"} must be divisible by ${t}.`):null),type:(t,i,r)=>!e.exports.types[i]||e.exports.types[i](t)||s.isVoid(t)?null:s.error(400,`${r?`"${r}"`:"item"} must be ${i}.`),unique:(e,t,i)=>!!s.isArray(e)&&(t&&!s.isUniq(e)?s.error(400,`${i?`"${i}"`:"item"} must be duplicates free.`):null)}}).call(t,i(0))}]);