(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.XPSchema = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){
module.exports=_dereq_("./lib");
},{"./lib":2}],2:[function(_dereq_,module,exports){
(function (global){
!function(e){"use strict";var t=e.XP||_dereq_("expandjs"),n=e.XPEmitter||_dereq_("xp-emitter"),i=_dereq_("./restrict"),r=_dereq_("./sanitize"),a=_dereq_("./validate"),u=function(e){return e.hasOwnProperty("input")||e.hasOwnProperty("options")},s=function(e,n){return e=t.assign({handle:n},e),t.withdraw(e,"method"),e},l=t.freeze(t.keys(a.types)),o=t.freeze(t.filter(t.map(r.sanitizers,s),u)),f=t.freeze(t.filter(t.map(a.validators,s),u));module.exports=e.XPSchema=new t.Class("XPSchema",{"extends":n,initialize:function(e){var t=this;n.call(t),t.options=e,t.fields=t.options.fields||{},t.strict=t.options.strict||!1,t.useful=t.options.useful||!1},filter:{promise:!0,value:function(e,n){var i=this;t.waterfall([function(t){i._assert({data:e},t)},function(n){n(null,t.forOwn(i.fields,function(t,n){t.reserved&&delete e[n]}))},function(t){t(null,e)}],n)}},merge:{promise:!0,value:function(e,n,i,r){var a=this;t.waterfall([function(t){a._assert({data:e,item:n},t)},function(r){r(null,t.forOwn(n||{},function(r,u){!t.isDefined(e[u])&&(!i||a.fields[u]&&a.fields[u].reserved)&&(e[u]=n[u])}))},function(t){t(null,e)}],r)}},prepare:{promise:!0,value:function(e,n){var i=this;t.waterfall([function(t){i._assert({data:e},t)},function(n){n(null,t.forOwn(i.fields,function(n,i){t.isDefined(n.value)&&t.isVoid(e[i])&&(e[i]=t.isFunction(n.value)?n.value():n.value)}))},function(t){t(null,e)}],n)}},restrict:{promise:!0,value:function(e,n){var r=this;t.waterfall([function(t){r._assert({data:e},t)},function(t){t(null,i(e,r.fields,r.options))},function(t){t(null,e)}],n)}},sanitize:{promise:!0,value:function(e,n){var i=this;t.waterfall([function(t){i._assert({data:e},t)},function(t){t(null,r(e,i.fields))},function(t){t(null,e)}],n)}},validate:{promise:!0,value:function(e,n,i){var r=this;t.waterfall([function(t){r._assert({data:e,item:n},t)},function(t){t(a(e,r.fields,n),null)},function(t){t(null,e)}],i)}},fields:{validate:function(e){return!t.isObject(e)&&"Object"}},sanitizers:{"static":!0,get:function(){return o}},strict:{set:function(e){return!!e}},types:{"static":!0,get:function(){return l}},useful:{set:function(e){return!!e}},validators:{"static":!0,get:function(){return f}},_assertData:{enumerable:!1,value:function(e){return!t.isObject(e)&&new t.ValidationError("data","Object",400)}},_assertItem:{enumerable:!1,value:function(e){return!t.isVoid(e)&&!t.isObject(e)&&new t.ValidationError("item","Object",500)}}})}("undefined"!=typeof window?window:global);
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./restrict":3,"./sanitize":4,"./validate":5,"expandjs":6,"xp-emitter":6}],3:[function(_dereq_,module,exports){
(function (global){
!function(e){"use strict";function i(e,i,o,r){return"list"===i[r].multi||"map"===i[r].multi?n["list"===i[r].multi?"forEach":"forOwn"](e,function(u,s){n.isObject(e[s])&&(i[r].fields||"recursive"===i[r].type)&&(e[s]=t(e[s],i[r].fields||i,o))}):n.isObject(e)&&(i[r].fields||"recursive"===i[r].type)&&(e=t(e,i[r].fields||i,o)),e}var t=module.exports,n=e.XP||_dereq_("expandjs");t=module.exports=function(e,t,o){return n.forOwn(e,function(r,u){return o.strict&&!t[u]?void delete e[u]:o.useful&&n.isVoid(e[u])?void delete e[u]:void(e[u]=i(e[u],t,o,u))}),e}}("undefined"!=typeof window?window:global);
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"expandjs":6}],4:[function(_dereq_,module,exports){
(function (global){
!function(i){"use strict";function t(i,t,o){return i=s.isDefined(i)?i:null,s.isObject(t[o])||s.isString(t[o],!0)?(i=e(i,t,o),"list"===t[o].multi||"map"===t[o].multi?s["list"===t[o].multi?"forEach":"forOwn"](i,function(r,u){i[u]=e(i[u],t,o,u),s.isObject(i[u])&&(t[o].fields||"recursive"===t[o].type)&&(i[u]=n(i[u],t[o].fields||t))}):s.isObject(i)&&(t[o].fields||"recursive"===t[o].type)&&(i=n(i,t[o].fields||t)),i):i}function e(i,t,e,o){i=s.isDefined(i)?i:null;var r=s.isString(t[e])?{type:t[e]}:t[e],u=!s.isVoid(o)||"list"!==r.multi&&"map"!==r.multi?"type":"multi",l=n.sanitizers[u].method(i,r[u]);return s.forOwn(r,function(i,t){n.sanitizers[t]&&"multi"!==t&&"type"!==t&&(l=n.sanitizers[t].method(l,i))}),l}var n=module.exports,s=i.XP||_dereq_("expandjs");n=module.exports=function(i,e){return s.forOwn(e,function(n,s){i[s]=t(i[s],e,s)}),i},n.sanitizers={multi:{method:function(i,t){return"list"===t&&s.isVoid(i)?[]:"map"===t&&s.isVoid(i)?{}:i}},type:{method:function(i,t){return"boolean"===t&&s.isVoid(i)?!1:i}}}}("undefined"!=typeof window?window:global);
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"expandjs":6}],5:[function(_dereq_,module,exports){
(function (global){
!function(t){"use strict";function i(t,i,a,u,s){t=r.isDefined(t)?t:null,(r.isObject(i[s])||r.isString(i[s],!0))&&(e(t,i,a,u,s),"list"===i[s].multi||"map"===i[s].multi?r["list"===i[s].multi?"forEach":"forOwn"](t,function(t,o){e(t,i,a,u+"["+o+"]",s,o),r.isObject(t)&&(i[s].fields||"recursive"===i[s].type)&&n(t,i[s].fields||i,a,u+"["+o+"]")}):r.isObject(t)&&(i[s].fields||"recursive"===i[s].type)&&n(t,i[s].fields||i,a,u))}function e(t,i,e,a,u,s){t=r.isDefined(t)?t:null;var o=r.isString(i[u])?{type:i[u]}:i[u],l=!r.isVoid(s)||"list"!==o.multi&&"map"!==o.multi?"type":"multi",m=n.validators[l].method(t,o[l],a);if(m)throw m;r.forOwn(o,function(i,r){if(n.validators[r]&&"multi"!==r&&"type"!==r&&("immutable"!==r||e)&&(m=n.validators[r].method(t,i,a,e&&e[u])))throw m})}var n=module.exports,r=t.XP||_dereq_("expandjs");n=module.exports=function(t,e,n,a){try{return r.forOwn(e,function(r,u){i(t[u],e,n,(a?a+".":"")+u,u)}),null}catch(u){return u}},n.patterns={camelCase:r.camelCaseRegex,capitalize:r.capitalizeRegex,kebabCase:r.kebabCaseRegex,keyCase:r.keyCaseRegex,lowerCase:r.lowerCaseRegex,snakeCase:r.snakeCaseRegex,startCase:r.startCaseRegex,trim:r.trimRegex,upperCase:r.upperCaseRegex,uuid:r.uuidRegex},n.types={"boolean":r.isBoolean,number:r.isFinite,object:r.isObject,recursive:r.isObject,string:r.isString},n.validators={exclusiveMaximum:{input:"number",type:"number",method:function(t,i,e){return r.isFinite(t)&&r.isFinite(i)?t>=i?new r.ValidationError(e||"data","less than "+i,400):null:!1}},exclusiveMinimum:{input:"number",type:"number",method:function(t,i,e){return r.isFinite(t)&&r.isFinite(i)?i>=t?new r.ValidationError(e||"data","greater than "+i,400):null:!1}},immutable:{input:"checkbox",method:function(t,i,e,n){return i&&!r.isEquivalent(t,n)?new r.ImmutableError(e||"data",409):null}},maximum:{input:"number",type:"number",method:function(t,i,e){return r.isFinite(t)&&r.isFinite(i)?t>i?new r.ValidationError(e||"data","a maximum of "+i,400):null:!1}},maxItems:{attributes:{min:1},input:"number",multi:!0,method:function(t,i,e){return!r.isArray(t)||!r.isFinite(i)||1>i?!1:t.length>i?new r.ValidationError(e||"data","a maximum of "+i+" items",400):null}},maxLength:{attributes:{min:1},input:"number",type:"string",method:function(t,i,e){return!r.isString(t)||!r.isFinite(i)||1>i?!1:t.length>i?new r.ValidationError(e||"data","a maximum of "+i+" chars",400):null}},minimum:{input:"number",type:"number",method:function(t,i,e){return r.isFinite(t)&&r.isFinite(i)?i>t?new r.ValidationError(e||"data","a minimum of "+i,400):null:!1}},minItems:{attributes:{min:1},input:"number",multi:!0,method:function(t,i,e){return r.isArray(t)&&r.isFinite(i)?t.length<i?new r.ValidationError(e||"data","a minimum of "+i+" items",400):null:!1}},minLength:{attributes:{min:1},input:"number",type:"string",method:function(t,i,e){return r.isString(t)&&r.isFinite(i)?t.length<i?new r.ValidationError(e||"data","a minimum of "+i+" chars",400):null:!1}},multi:{options:["none","list","map"],method:function(t,i,e){return"list"!==i||r.isArray(t)?"map"!==i||r.isObject(t)?null:new r.ValidationError(e||"data","a map",400):new r.ValidationError(e||"data","a list",400)}},multipleOf:{input:"number",type:"number",method:function(t,i,e){return r.isFinite(t)&&r.isFinite(i)?t%i!==0?new r.ValidationError(e||"data","divisible by "+i,400):null:!1}},pattern:{input:"text",options:r.keys(n.patterns),type:"string",method:function(t,i,e){var a=r.isString(t)&&r.isString(i,!0)&&(n.patterns[i]||i);return r.isString(a)&&r.isRegExp(a=r.toRegExp(i))&&(n.patterns[i]=a),a&&!a.test(t)?new r.InvalidError(e||"data",400):null}},required:{input:"checkbox",method:function(t,i,e){return i&&r.isEmpty(t)?new r.RequiredError(e||"data",400):null}},type:{attributes:{required:!0},options:r.keys(n.types),method:function(t,i,e){return!n.types[i]||n.types[i](t)||r.isVoid(t)?null:new r.ValidationError(e||"data",i||"any",400)}},uniqueItems:{input:"checkbox",multi:!0,method:function(t,i,e){return r.isArray(t)?i&&!r.isUniq(t)?new r.ValidationError(e||"data","should not have duplicates",400):null:!1}}}}("undefined"!=typeof window?window:global);
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"expandjs":6}],6:[function(_dereq_,module,exports){

},{}]},{},[1])(1)
});


//# sourceMappingURL=xp-schema.min.map