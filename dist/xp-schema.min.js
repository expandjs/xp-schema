(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.XPSchema = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){

},{}],2:[function(_dereq_,module,exports){
module.exports=_dereq_("./lib");
},{"./lib":3}],3:[function(_dereq_,module,exports){
(function (global){
!function(e){"use strict";var t=e.XP||_dereq_("expandjs"),n=e.XPEmitter||_dereq_("xp-emitter"),i=_dereq_("./sanitize"),a=_dereq_("./validate"),r=function(e){return t.has(e,"input")||t.has(e,"options")},s=function(e,n){return e=t.assign({handle:n},e),t.withdraw(e,"method"),e},u=t.freeze(t.keys(a.types)),l=t.freeze(t.filter(t.map(i.sanitizers,s),r)),o=t.freeze(t.filter(t.map(a.validators,s),r));module.exports=e.XPSchema=new t.Class("XPSchema",{"extends":n,initialize:function(e){var t=this;n.call(t),t.options=e,t.fields=t.options.fields||{},t.loose=t.options.loose||!1,t.useful=t.options.useful||!1},filter:{promise:!0,value:function(e,n){var i=this;t.waterfall([function(t){i._assert({data:e},t)},function(n){n(null,t.forOwn(i.fields,function(t,n){t.reserved&&delete e[n]}))},function(t){t(null,e)}],n)}},merge:{promise:!0,value:function(e,n,i,a){var r=this;t.waterfall([function(t){r._assert({data:e,item:n},t)},function(a){a(null,t.forOwn(n||{},function(a,s){!t.isDefined(e[s])&&(!i||r.fields[s]&&r.fields[s].reserved)&&(e[s]=n[s])}))},function(t){t(null,e)}],a)}},prepare:{promise:!0,value:function(e,n){var i=this;t.waterfall([function(t){i._assert({data:e},t)},function(n){n(null,t.forOwn(i.fields,function(n,i){t.isDefined(n.value)&&t.isVoid(e[i])&&(e[i]=t.isFunction(n.value)?n.value():n.value)}))},function(t){t(null,e)}],n)}},sanitize:{promise:!0,value:function(e,n){var a=this;t.waterfall([function(t){a._assert({data:e},t)},function(t){t(null,i(e,a.fields,a.options))},function(t){t(null,e)}],n)}},validate:{promise:!0,value:function(e,n,i){var r=this;t.waterfall([function(t){r._assert({data:e,item:n},t)},function(t){t(a(e,r.fields,n),null)},function(t){t(null,e)}],i)}},fields:{validate:function(e){return!t.isObject(e)&&"Object"}},loose:{set:function(e){return!!e}},sanitizers:{"static":!0,get:function(){return l}},types:{"static":!0,get:function(){return u}},useful:{set:function(e){return!!e}},validators:{"static":!0,get:function(){return o}},_assertItem:{enumerable:!1,value:function(e){return!t.isVoid(e)&&!t.isObject(e)&&new t.ValidationError("item","Object",500)}},_assertData:{enumerable:!1,value:function(e){return!t.isObject(e)&&new t.ValidationError("data","Object",400)}}})}("undefined"!=typeof window?window:global);
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./sanitize":4,"./validate":5,"expandjs":1,"xp-emitter":1}],4:[function(_dereq_,module,exports){
(function (global){
!function(e){"use strict";function i(e,i,s,r){return e=o.isDefined(e)?e:null,o.isObject(i[r])||o.isString(i[r],!0)?(e=n(e,i,s,r),i[r].map||i[r].multi?o[i[r].map?"forOwn":"forEach"](e,function(u,l){e[l]=n(e[l],i,r,l),o.isObject(e[l])&&(i[r].fields||"recursive"===i[r].type)&&(e[l]=t(e[l],i[r].fields||i,o.assign({},s,{loose:i[r].loose})))}):o.isObject(e)&&(i[r].fields||"recursive"===i[r].type)&&(e=t(e,i[r].fields||i,o.assign({},s,{loose:i[r].loose}))),e):e}function n(e,i,n,s,r){e=o.isDefined(e)?e:null;var u=o.isString(i[s])&&{type:i[s]}||i[s],l=o.isVoid(r)&&(u.map&&"map"||u.multi&&"multi")||"type",d=t.sanitizers[l].method(e,u[l]);return o.forOwn(u,function(e,i){t.sanitizers[i]&&"map"!==i&&"multi"!==i&&"type"!==i&&(d=t.sanitizers[i].method(d,e))}),d}var t=module.exports,o=e.XP||_dereq_("expandjs");t=module.exports=function(e,n,t){return o.forOwn(e,function(i,o){t.loose||n[o]||delete e[o]}),o.forOwn(n,function(s,r){e[r]=i(e[r],n,t,r),t.useful&&o.isVoid(e[r])&&delete e[r]}),e},t.sanitizers={map:{method:function(e,i){return o.isVoid(e)&&i?{}:e}},multi:{method:function(e,i){return o.isVoid(e)&&i?[]:e}},type:{method:function(e,i){return o.isVoid(e)&&"boolean"===i?!1:e}}}}("undefined"!=typeof window?window:global);
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"expandjs":1}],5:[function(_dereq_,module,exports){
(function (global){
!function(t){"use strict";function e(t,e,a,u,o){t=r.isDefined(t)?t:null,(r.isObject(e[o])||r.isString(e[o],!0))&&(i(t,e,a,u,o),e[o].map||e[o].multi?r[e[o].map?"forOwn":"forEach"](t,function(t,s){i(t,e,u+"["+s+"]",o,s),r.isObject(t)&&(e[o].fields||"recursive"===e[o].type)&&n(t,e[o].fields||e,a,u+"["+s+"]")}):r.isObject(t)&&(e[o].fields||"recursive"===e[o].type)&&n(t,e[o].fields||e,a,u))}function i(t,e,i,a,u,o){t=r.isDefined(t)?t:null;var s=r.isString(e[u])&&{type:e[u]}||e[u],m=r.isVoid(o)&&(s.map&&"map"||s.multi&&"multi")||"type",l=n.validators[m].method(t,s[m],a);if(l)throw l;r.forOwn(s,function(e,r){if(n.validators[r]&&"map"!==r&&"multi"!==r&&"type"!==r&&("immutable"!==r||i)&&(l=n.validators[r].method(t,e,a,i&&i[u])))throw l})}var n=module.exports,r=t.XP||_dereq_("expandjs");n=module.exports=function(t,i,n,a){try{return r.forOwn(i,function(r,u){e(t[u],i,n,(a?a+".":"")+u,u)}),null}catch(u){return u}},n.patterns={camelCase:r.camelCaseRegex,capitalize:r.capitalizeRegex,kebabCase:r.kebabCaseRegex,keyCase:r.keyCaseRegex,lowerCase:r.lowerCaseRegex,snakeCase:r.snakeCaseRegex,startCase:r.startCaseRegex,trim:r.trimRegex,upperCase:r.upperCaseRegex,uuid:r.uuidRegex},n.types={"boolean":r.isBoolean,input:r.isInput,number:r.isFinite,object:r.isObject,recursive:r.isObject,string:r.isString},n.validators={exclusiveMaximum:{input:"number",type:"number",method:function(t,e,i){return r.isFinite(t)&&r.isFinite(e)?t>=e?new r.ValidationError(i||"data","less than "+e,400):null:!1}},exclusiveMinimum:{input:"number",type:"number",method:function(t,e,i){return r.isFinite(t)&&r.isFinite(e)?e>=t?new r.ValidationError(i||"data","greater than "+e,400):null:!1}},immutable:{input:"checkbox",method:function(t,e,i,n){return e&&!r.isEquivalent(t,n)?new r.ImmutableError(i||"data",409):null}},map:{input:"checkbox",multi:!0,method:function(t,e,i){return r.xor(e,r.isObject(t))?new r.ValidationError(i||"data","a map",400):null}},maximum:{input:"number",type:"number",method:function(t,e,i){return r.isFinite(t)&&r.isFinite(e)?t>e?new r.ValidationError(i||"data","a maximum of "+e,400):null:!1}},maxItems:{attributes:{min:1},input:"number",multi:!0,method:function(t,e,i){return!r.isArray(t)||!r.isFinite(e)||1>e?!1:t.length>e?new r.ValidationError(i||"data","a maximum of "+e+" items",400):null}},maxLength:{attributes:{min:1},input:"number",type:"string",method:function(t,e,i){return!r.isString(t)||!r.isFinite(e)||1>e?!1:t.length>e?new r.ValidationError(i||"data","a maximum of "+e+" chars",400):null}},minimum:{input:"number",type:"number",method:function(t,e,i){return r.isFinite(t)&&r.isFinite(e)?e>t?new r.ValidationError(i||"data","a minimum of "+e,400):null:!1}},minItems:{attributes:{min:1},input:"number",multi:!0,method:function(t,e,i){return r.isArray(t)&&r.isFinite(e)?t.length<e?new r.ValidationError(i||"data","a minimum of "+e+" items",400):null:!1}},minLength:{attributes:{min:1},input:"number",type:"string",method:function(t,e,i){return r.isString(t)&&r.isFinite(e)?t.length<e?new r.ValidationError(i||"data","a minimum of "+e+" chars",400):null:!1}},multi:{input:"checkbox",method:function(t,e,i){return r.xor(e,r.isArray(t))?new r.ValidationError(i||"data","multi",400):null}},multipleOf:{input:"number",type:"number",method:function(t,e,i){return r.isFinite(t)&&r.isFinite(e)?t%e!==0?new r.ValidationError(i||"data","divisible by "+e,400):null:!1}},pattern:{input:"text",options:r.keys(n.patterns),type:"string",method:function(t,e,i){var a=r.isString(t)&&r.isString(e,!0)&&(n.patterns[e]||e);return r.isString(a)&&r.isRegExp(a=r.toRegExp(e))&&(n.patterns[e]=a),a?a.test(t)?null:new r.InvalidError(i||"data",400):!1}},required:{input:"checkbox",method:function(t,e,i){return e&&r.isEmpty(t)?new r.RequiredError(i||"data",400):null}},type:{attributes:{required:!0},options:r.keys(n.types),method:function(t,e,i){return!n.types[e]||n.types[e](t)||r.isVoid(t)?null:new r.ValidationError(i||"data",e||"any",400)}},uniqueItems:{input:"checkbox",multi:!0,method:function(t,e,i){return r.isArray(t)?e&&!r.isUniq(t)?new r.ValidationError(i||"data","should not have duplicates",400):null:!1}}}}("undefined"!=typeof window?window:global);
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"expandjs":1}]},{},[2])(2)
});


//# sourceMappingURL=xp-schema.min.map